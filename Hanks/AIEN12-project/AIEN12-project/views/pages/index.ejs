<!DOCTYPE html>
<html class="no-js vlt-is--homepage vlt-is--footer-fixed" lang="en">

<head>
    <meta charset="utf-8">
    <title>Home</title>
    <meta name="description" content="Personal CV/Resume HTML5 Template">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!--Framework-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <!--Fonts-->
    <link rel="stylesheet" href="static/css/style.css">
    <!--Icons-->
    <link rel="stylesheet" href="static/css/lineicons.css">
    <!--Plugins-->
    <link rel="stylesheet" href="static/css/vlt-plugins.min.css">
    <!--Style-->
    <link rel="stylesheet" href="static/css/vlt-main.min.css">
    <!--Custom-->
    <link rel="stylesheet" href="assets/css/custom.css">
    <style>
        th{
            text-align:right;
        }
        .title {
            text-align: center;
            font-size: 1.5em
        }
        .loader {
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 130px;
            height: 130px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class=" animsition">
    <header class="vlt-header vlt-header--default">
        <div class="vlt-navbar vlt-navbar--main vlt-navbar--transparent vlt-navbar--sticky">
            <div class="vlt-navbar-background"></div>
            <div class="vlt-navbar-inner">
                <div class="vlt-navbar-inner--left">
                    <a class="vlt-navbar-logo" href="/"><img style="width:200px;height:100px" src="static/picture/cell.png" alt="Gilber"></a>
                </div>
                <div class="vlt-navbar-inner--center">
                    <div class="container">
                        <nav class="vlt-default-menu__navigation" style="margin-left:30%">
                            <ul class="sf-menu">
                                <li data-menuanchor="Home">
                                    <a href="#Home" id="home">首頁</a>
                                </li>
                                <li data-menuanchor="About">
                                    <a href="#About" onclick="data()">查詢病人資料</a>
                                </li>
                                <li data-menuanchor="Projects">
                                    <a href="#Projects" onclick="select()">X光片檢視</a>
                                </li>
                                <li data-menuanchor="Education">
                                    <a href="#Education" onclick="hied()">X光片分析</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <!--登入and新增病人-->
                <div class="vlt-navbar-inner--right">
                    <ul class="sf-menu">
                        <li style="margin-right:50px">
                            <a href="#" onclick="add()">新增病人資料</a>
                        </li>
                        <li data-menuanchor="Login">
                            <a href="#Login" id="loginmember" onclick="member()">登入病人</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <!--Offcanvas Menu-->
    <input type="text" style="display:none" id="member" value="">
    <!--Site Overlay-->
    <div class="vlt-site-overlay"></div>
    <!--Main-->
    <main class="vlt-main">
        <div class="vlt-fullpage-slider" data-loop-top="" data-loop-bottom="" data-speed="450">
            <!--首頁-->
            <div class="vlt-section pp-scrollable" data-anchor="Home">
                <div class="vlt-section__vertical-align">
                    <div class="vlt-section__content">
                        <div class="vlt-section__ken-burn-background has-mobile-image"><img src="static/picture/bakeground.png" style="opacity:0.2" alt=""><img src="static/picture/home-mobile.jpg" alt=""></div>
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="vlt-animated-block" data-animation-name="fadeInUpSm" style="animation-delay:.2s; animation-duration:700ms;">
                                        <h1 class="vlt-large-heading" style="font-size:60px;font-style:italic;text-decoration:underline">疾病相關影像診療</h1>
                                    </div>
                                    <div class="vlt-gap-10"></div>
                                    <div class="vlt-animated-block" data-animation-name="fadeInUpSm" style="animation-delay:.3s; animation-duration:700ms;">
                                        <p>AIEN12第一組專題</p>
                                    </div>
                                    <div class="vlt-gap-15"></div>
                                </div>
                                <div class="col-lg-2"></div>
                                <div class="col-lg-4">

                                    <dl>
                                        <dt><label style="font-size:20px">１.肺炎X –ray 影像學習</label></dt>
                                        <div style="margin-left:25px;margin-top:0"><dd><p style="font-size: 15px">針對肺炎的X-Ray影像做學習訓練，達到輔助診斷。</p></dd></div>
                                        <dt><label style="font-size:20px">２.深度學習提升診斷及治療正確率</label></dt>
                                        <div style="margin-left:25px;margin-top:0"><dd><p style="font-size: 15px">能夠在病例資料庫中，閱讀其他病症的醫學診斷圖像，透過深度學習提升診斷和治療的正確率，輔助醫師進行診療。</p></dd></div>
                                        <dt><label style="font-size:20px">３.影像比對協助醫師</label></dt>
                                        <div style="margin-left:25px;margin-top:0"><dd><p style="font-size: 15px">每次新舊影像比對，醫師可得知病情惡化或改善作為參考。</p></dd></div>
                                        <dt><label style="font-size:20px">４.診療聊天機器人</label></dt>
                                        <div style="margin-left:25px;margin-top:0"><dd><p style="font-size: 15px">聊天機器人以醫生的診斷進行語意分析，提供病人問答式診療指引。</p></dd></div>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--查詢病人資料-->
            <div class="vlt-section pp-scrollable" data-anchor="About">
                <div class="vlt-section__ken-burn-background has-mobile-image"><img src="static/picture/bakeground.png" style="opacity:0.2" alt=""></div>
                <div class="container" style="margin-top:200px;" id="search"></div>
            </div>
            <!--X光片檢視-->
            <div class="vlt-section pp-scrollable" data-anchor="Projects">
                <div class="vlt-section__ken-burn-background has-mobile-image"><img src="static/picture/bakeground.png" style="opacity:0.2" alt=""></div>
                <div class="container" style="margin-top:200px;">
                    <div style="margin:0 0">
                        <div class="row" id="date"></div><br>
                        <div class="row" style="padding-left:0">
                            <table id="t1" align="center" style="border:2px solid black;border-radius:10px;background-color:#D0D0D0"></table>
                        </div>
                    </div>
                </div>
            </div>
            <!--X光片分析-->
            <div class="vlt-section pp-scrollable" data-anchor="Education">
                <div class="vlt-section__ken-burn-background has-mobile-image"><img src="static/picture/bakeground.png" style="opacity:0.2" alt=""></div>
                <div class="container" style="margin-top:200px;">
                    <div class="row" id="date">
                        <input type="file" style="width:200px;color:white;margin-left:400px" id="file"><button class="btn btn-primary" onclick="analysis()">分析</button>
                    </div>
                    <div class="vlt-gap-50"></div>
                    <div class="row" id="date">
                        <img id="demo" name="demo" style="position:absolute;margin-left:260px" /><div id="dt1" style="margin-left:550px;width:500px;height:500px;border: 2px solid black;border-radius:10px;background-color:#D0D0D0"></div>
                        <div class="loader" style="position: absolute;left:950px"></div>
                        <div id="text" style="position: absolute;left:975px;top:340px;color:white">Analyzing...</div>
                    </div>
                    
                </div>
            </div>
            <!--登入病人-->
            <div class="vlt-section pp-scrollable" data-anchor="Login" id="login">
                <!--<div class="vlt-section__vertical-align">-->
                <!--<div class="vlt-section__content">-->
                <div class="vlt-section__ken-burn-background has-mobile-image"><img src="static/picture/bakeground.png" style="opacity:0.2" alt=""></div>
                <div class="container" style="margin-top:200px;" id="search">
                    <div style="margin:0 30%">
                        <div class="row">
                            <input list="browsers" class="form-control" name="card" id="card" style="width:250px;" placeholder="請輸入病人身分證字號..." onkeyup="inquire()" />&nbsp<button class="btn btn-primary" onclick="search()">登入</button>
                            <datalist id="browsers">
                            </datalist>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="static/js/jquery-3.5.1.min.js"></script>
    <script src="static/js/vlt-plugins.min.js"></script>
    <script src="static/js/vlt-helpers.js"></script>
    <script src="static/js/vlt-controllers.min.js"></script>
</body>
<script>
    $("#dt1").hide()
    $(".loader").hide()
    $("#text").hide()
    //病人身分證字號查詢
    function inquire() {
        user = {
            m_card: $("#card").val()
        }
        $.ajax({
            type: 'post',
            url: 'http://localhost:3000/sql/inquire',
            data: user
        }).done(function (result) {
            var str = ""
            result.forEach(function (data) {
                str += "<option value='" + data['m_card'] + "'>";
            })
            $("#browsers").html(str)
        }).fail(function (err) {
            console.log(err.statusText);
        })
    }

    //登出
    function member() {
        if ($("#member").val() != "") {
            $("#loginmember").html('登入病人')
            $("#member").val('')
            $('#loginmember').attr('href', '#Login')
        }
    }

    //病人登入
    function search() {
        user = {
            m_card: $("#card").val()
        }
        $.ajax({
            type: 'post',
            url: 'http://localhost:3000/sql/search',
            data: user
        }).done(function (result) {
            if (result == "1") {
                alert('查無此人')
            } else {
                $("#loginmember").html(result[0]['m_name'])
                $('#loginmember').attr('href', '#')
                $("#member").val(result[0]['m_id'])
                window.location.href = '#Home';
            }
        }).fail(function (err) {
            console.log(err.statusText);
        })
    }

    //病人基本資料查詢
    function data() {
        if ($("#member").val() == "") {
            document.getElementById("search").innerHTML = "<h4 align='center'>請登入病人資訊</h4>";
        } else {
            $.ajax({
                type: 'post',
                url: 'http://localhost:3000/sql/data',
            }).done(function (result) {
                console.log(result)
                a = result[0]['m_birthday'].substring(0, 10)
                a = a.split('-')
                day = parseInt(a[2]) + 1
                if (day < 10) {
                    day = day.toString()
                    day = "0" + day
                }
                var str = '<table style="border:2px solid #000000;width:80%;margin:10px auto;border-radius:30px;border-collapse:separate;background-color: #D0D0D0;">'
                str += '<tr style="height:30px"></tr><tr ><th colspan="6" class="title" >基本資料</th></tr>'
                str += '<tr><th>姓名：</th><td>' + result[0]['m_name'] + '</td><th>生日：</th><td>' + a[0]+'-'+a[1]+'-'+day + '</td><th>身分證：</th><td>' + result[0]['m_card'] +'</td></tr>'
                str += '<tr><th>電話1：</th><td>' + result[0]['m_phone1'] + '</td><th>電話2：</th><td>' + result[0]['m_phone2'] + '</td><th>行動電話：</th><td>' + result[0]['m_cellphone'] +'</td></tr>'
                str += '<tr><th>性別：</th><td>' + result[0]['m_gender'] + '</td><th>血型：</th><td>' + result[0]['m_blood'] + '</td><th>地址：</th><td>' + result[0]['m_address'] +'</td></tr>'
                str += '<tr style="height:30px"></tr><tr><th class="title" colspan="6">家庭</th></tr>'
                str += '<tr><th colspan="2">婚姻狀況：</th><td colspan="1">' + result[0]['m_marriage'] + '</td><th colspan="2">子女：</th><td>' + result[0]['m_child'] +'</td></tr>'
                str += '<tr style="height:30px"></tr><tr><th class="title" colspan="6">其他</th></tr>'
                str += '<tr><th>教育程度：</th><td>' + result[0]['m_education'] + '</td><th>工作：</th><td>' + result[0]['m_jobs'] + '</td><th>過敏：</th><td>' + result[0]['m_allergy'] +'</td></tr>'
                str += '<tr style="height:30px"></tr><tr><th class="title" colspan="6">習慣</th></tr>'
                str += '<tr><th>抽菸：</th><td>' + result[0]['m_smokes'] +'年</td><th>檳榔：</th><td>' + result[0]['m_areca'] +'</td><th>喝酒：</th><td>' + result[0]['m_wine'] +'</td></tr>'
                str += '<tr style="height:30px"></tr><tr><th class="title" colspan="6">過去病史</th></tr>'
                str += '<tr ><td colspan="6" style="text-align:center">' + result[0]['m_history'] +'</td></tr><tr style="height:30px"></tr>'
                str += '</table>'
                document.getElementById("search").innerHTML = str
            }).fail(function (err) {
                console.log(err.statusText);
            })
        }

    }

    //X光照片日期查詢
    function select() {
        if ($("#member").val() == "") {
            document.getElementById("date").innerHTML = "<h4 style='margin-left:440px'>請登入病人資訊</h4>";
        } else {
            $("#date").css('margin-left', '30%')
            var str = '<select id="s1" class="form-control" style="width:200px;height:50px">'
            $.ajax({
                type: 'post',
                url: 'http://localhost:3000/sql/select',
            }).done(function (result) {
                result.forEach(function (data) {
                    date = data['date'].substring(0, 10)
                    str += "<option value='" + date + "'>" + date + "</option>";
                })
                str += '</select>'
                str += '&nbsp&nbsp&nbsp<button class="btn btn-primary"onclick="photosearch()">查尋</button>'
                $("#date").html(str)
            }).fail(function (err) {
                console.log(err.statusText);
            })
        }
    }

    //X光照片查詢
    function photosearch() {
        user = {
            p_date: $("#s1").val()
        }
        $.ajax({
            type: 'post',
            url: 'http://localhost:3000/sql/photosearch',
            data: user
        }).done(function (result) {
            var str = "<tr>"
            var i = 1
            result.forEach(function (data) {
                if (i % 6 == 0) {
                    str += "</tr><tr>"
                }
                date = data['date'].substring(0, 10)
                str += "<td style='padding:20px 20px;color:#000000' align='center' onclick='photoshow(" + data['p_id'] + ")'><img style='max-width:none;width:150px;height:150px' src='./images/" + data['p_name'] + "'><br><br>" + date + "</td>";
                i += 1
            })
            str += "</tr>"
            console.log(str)
            $("#t1").html(str)
            $("#t1").css("border-collapse", "separate")
        }).fail(function (err) {
            console.log(err.statusText);
        })
    }
    //上傳圖檔預覽
    $('#file').change(function () {
        var file = $('#file')[0].files[0];
        var reader = new FileReader;
        reader.onload = function (e) {
            b = e.target.result
            $('#demo').css('width', '500px').css('height', '500px')
            $('#demo').attr('src', e.target.result);
        };
        reader.readAsDataURL(file);
    });

    //X光片分析
    function analysis() {
        $(".loader").show()
        $("#text").show()
        $("#demo").hide()
        $("#demo").animate({
            left: "-=260px",
        }, 1000)
        var user = {
            img_name: $('#file')[0].files[0]['name']
        }

        //setTimeout(function () { $('#dt1').show(400) }, 1000);
        $.ajax({
            type: 'post',
            url: 'http://localhost:3000/sql/open_python',
            data: user
        }).done(function (result) {
            $(".loader").hide()
            $("#text").hide()
            $("#demo").show()
            $('#dt1').show()
            $('#demo').css('left', '230px')
            var str = ''
            $.each(result, function (key, value) {
                if (key == 'max') {
                    return false
                }
                if (value == result['max']) {
                    str += "<label style='background-color:#FF7575;color:#000000;margin:10px 10px;line-height:0.5;display:inline'>" + key + " : " + value + "</label><br>"
                } else {
                    str += "<label style='color:#000000;margin:10px 10px;line-height:0.5;display:inline'>" + key + " : " + value + "</label><br>"
                }
            })
            $('#dt1').html(str)
        }).fail(function (err) {
            console.log(err.statusText);
        })
    }

    //X光照片比對(彈出新視窗)
    function photoshow(a) {
        window.open("/photoshow?" + a, "photoshow", config = "height=650,width=500,scrollbars=no,resizable=no,location=no,menubar=no,status=no,resizable=no,status=no")
    }

    function hied() {
        $("#dt1").hide()
        //$('#demo').css('left', '456.8px')
        $('#demo').css('width', '0px').css('height', '0px')
        $('#demo').attr('src', '');
    }

    function add() {
        window.open("/add", "新增病人資料", config = "height=840,width=1140,scrollbars=no,resizable=no,location=no,menubar=no,status=no,resizable=no,status=no")
    }
</script>
</html>